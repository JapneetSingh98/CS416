<!DOCTYPE html>
<html>
    <style> /* set the CSS */

        /* tooltip code adapted from https://bl.ocks.org/d3noob/a22c42db65eb00d4e369 */
        body { font: 12px Arial;}
        div.tooltip {	
            position: absolute;			
            text-align: center;			
            width: 400px;					
            height: 28px;					
            padding: 2px;				
            font: 12px sans-serif;	
            background: lightsteelblue;	
            border: 0px;		
            border-radius: 8px;			
            pointer-events: none;			
        }
        
    </style>

    <script src='https://d3js.org/d3.v5.min.js'></script>

    <body onload='init()'>
        <section id="section01" class="demo">
            <h1>Number of Words Spoken per Character Throughout 'The Office'</h1>
            <svg id="wordsPerCharacter" width=1200 height=800></svg>
            <!-- <h1>Scroll Down Button #1</h1> -->
            <a href="#section02"><span></span>Next</a>
        </section>
        <section id="section02" class="demo">
            <h1>The textarea element - Disable default resize option</h1>
            <svg width=1200 height=800></svg>
            <!-- <h1>Scroll Down Button #1</h1>
            <a href="#section02"><span></span>Scroll</a> -->
        </section>
        
        <!-- <p id="demo"></p> -->

        <!-- javascript for number of words said per character chart -->
        <script>
            async function init() {

                //document.getElementById("demo").innerHTML = "before";

                data = await d3.csv("https://raw.githubusercontent.com/JapneetSingh98/japneetsingh98.github.io/main/the-office-lines-scripts.csv");
                
                //document.getElementById("demo").innerHTML = "after";

                xdomain = [0, 187];
                xrange  = [0, 1000];
                ydomain = [0, 200000];
                yrange  = [700, 0];

                xs = d3.scaleLinear().domain(xdomain).range(xrange);
                ys = d3.scaleLinear().domain(ydomain).range(yrange);

                var numWords = {};
                var lastAppearance = {};

                var keyPeople = {
                    "Michael": "green",
                    "Jim": "blue",
                    "Dwight": "brown",
                    "Pam": "pink",
                    "Andy": "red",
                    "Oscar": "purple",
                };

                var div = d3.select("body").append("div").attr("class", "tooltip").style("opacity", 0);

                d3.select("#wordsPerCharacter").append("g").attr("transform", "translate(50,0)")
                    .selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                        .attr("fill", function(d, i) {
                            if (d.speaker in keyPeople) {
                                return keyPeople[d.speaker];
                            } else {
                                return "lightgrey";
                            }
                        })
                        .attr("cx", function(d, i) {
                            lastAppearance[d.speaker] = parseInt(d.total_episode_number);
                            return xs(lastAppearance[d.speaker]);
                        })
                        .attr("cy", function(d, i) {
                            if (d.speaker in numWords) {
                                numWords[d.speaker] = parseInt(numWords[d.speaker]) + parseInt(d.line_text.split(" ").length);
                            } else {
                                numWords[d.speaker] = parseInt(d.line_text.split(" ").length);
                            }
                            
                            return ys(parseInt(numWords[d.speaker]));
                        })
                        .attr("r",  function(d, i) {
                            if (d.speaker in keyPeople) {
                                return 2.5;
                            } else {
                                return 1;
                            }
                        })
                        .on("mouseover", function(d) {
                            div.transition()		
                                .duration(200)		
                                .style("opacity", .9);		
                            div.html(d.speaker + " - " + d.season + "_" +d.episode + "<br>" + d.line_text)	
                                .style("left", (d3.event.pageX) + "px")		
                                .style("top", (d3.event.pageY - 28) + "px");	
                        })
                        .on("mouseout", function(d) {		
                            div.transition()		
                                .duration(500)		
                                .style("opacity", 0);
                        });

                var x_axis = d3.axisBottom(xs)
                    .tickValues([1, 7, 50, 75, 100, 125, 150, 175, 186]); 
                var y_axis = d3.axisLeft(ys)
                    .tickValues([0, 5000, 10000, 20000, 40000, 80000, 160000]); 

                d3.select('svg').append('g').attr('transform', 'translate(50,700)').call(x_axis);
                d3.select('svg').append('g').attr('transform', 'translate(50,0)').call(y_axis);

            }
        </script>


    </body>
</html>