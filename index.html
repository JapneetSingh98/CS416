<!DOCTYPE html>
<html>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style> circle {fill: lightblue; stroke: black;} </style>
    <body onload='init()'>
        <svg width=1200 height=600>
        </svg>

        <p id="demo"></p>


        <script>
            async function init() {

                document.getElementById("demo").innerHTML = "before";

                data = await d3.csv("https://raw.githubusercontent.com/JapneetSingh98/japneetsingh98.github.io/main/the-office-lines-scripts.csv");
                
                document.getElementById("demo").innerHTML = "after";

                xdomain = [0, 187];
                xrange = [0, 1000];
                ydomain = [0, 1000000];
                yrange = [500, 0];

                xs = d3.scaleLinear().domain(xdomain).range(xrange);
                ys = d3.scaleLinear().domain(ydomain).range(yrange);

                var numWords = {};          //  {
                                            //      speaker: curWordCount
                                            //  }
                var lastAppearance = {};    //  {
                                            //      speaker: lastAppearance
                                            //  }

                var curSpeaker = "";
                var x1 = 0;
                var y1 = 0;

                d3.select("svg")
                    .append("g")
                        .attr("transform", "translate(50,50)")
                        .selectAll("line")
                        .data(data)
                        .enter()
                        .append("line")
                            .style("stroke", function(d, i) {
                                curSpeaker = d.speaker;

                                if (curSpeaker == "Michael") {
                                    return "lightgreen";
                                } else if (curSpeaker == "Jim") {
                                    return "blue";
                                } else if (curSpeaker == "Dwight") {
                                    return "brown";
                                } else if (curSpeaker == "Pam") {
                                    return "pink";
                                } else {
                                    return "black";
                                }
                            })
                            .style("stroke-width", 2)
                            .attr("x1", function(d, i) { 

                                if (curSpeaker in lastAppearance) {
                                    x1 = parseInt(lastAppearance[curSpeaker]);
                                    return xs(x1);
                                } else {
                                    x1 = parseInt(d.total_episode_number);
                                    return xs(x1);
                                }
                                
                            })
                            .attr("y1", function(d, i) {
                                return ys(parseInt(numWords[curSpeaker]));
                                if (curSpeaker in numWords) {
                                    y1 = parseInt(numWords[curSpeaker]);
                                    return ys(y1);
                                } else {
                                    y1 = 0;
                                    return ys(y1);
                                }
                            })
                            .attr("x2", function(d, i) {
                                lastAppearance[curSpeaker] = parseInt(d.total_episode_number);
                                return xs(lastAppearance[curSpeaker]);
                            })
                            .attr("y2", function(d, i) {
                                numWords[curSpeaker] = y1 + parseInt(d.line_text.split(" ").length);
                                return ys(numWords[curSpeaker]);
                            });

                            //.attr("cx", function(d, i) { return xs(parseInt(d.season)*100 + parseInt(d.episode)); })
                            //.attr("cy", function(d, i) { return ys(d.line_text.split(" ").length); })
                            //.attr("r",    function(d, i) { return 2; });

                // var y_axis = d3.axisLeft(ys)
                //        .tickValues([10, 20, 50, 100]); 

                var x_axis = d3.axisBottom(xs)
                       .tickValues([0, 25, 50, 75, 100, 125, 150, 175, 200]); 

                d3.select('svg')
                   .append('g')
                       .attr('transform', 'translate(50,600)')
                       .call(x_axis);

            }
        </script>
    </body>
    <!-- 
    </html>
    <html>
        -->
    <body>
        <h1>Hello World</h1>
        <p>I'm hosted with GitHub Pages.</p>
    </body>
</html>